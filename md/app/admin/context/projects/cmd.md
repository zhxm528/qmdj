# 项目管理 (projects) 规则文件

本文件用于定义 `projects` 表的扩展功能和自定义规则。

## 表信息

- **表名**：`projects`
- **表中文名**：项目管理
- **面板路径**：`context`
- **菜单路径**：`projects`

## 表结构

```sql
CREATE TABLE projects (
    id           UUID PRIMARY KEY DEFAULT gen_random_uuid()
        -- 主键：项目 ID，UUID 类型，方便分布式唯一标识
  , code         VARCHAR(50)  NOT NULL UNIQUE
        -- 项目代码：如 'qmdj'，在代码中引用用它，不建议修改
  , name         VARCHAR(100) NOT NULL
        -- 项目名称：如 '奇门遁甲问事助手'，给人看的名字
  , description  TEXT
        -- 项目描述：说明该项目做什么、适用范围等
  , created_at   TIMESTAMPTZ  NOT NULL DEFAULT NOW()
        -- 创建时间：记录该项目记录什么时候创建
  , updated_at   TIMESTAMPTZ  NOT NULL DEFAULT NOW()
        -- 更新时间：记录该项目记录最后一次修改时间
);
```

## 字段说明

| 字段名 | 中文名 | 类型 | 必填 | 主键 | 自增 | 默认值 | 说明 |
|--------|--------|------|------|------|------|--------|------|
| id | ID | UUID | 是 | 是 | 否 | gen_random_uuid() | 项目ID，UUID类型 |
| code | 项目代码 | VARCHAR(50) | 是 | 否 | 否 | - | 项目代码，唯一，如 'qmdj' |
| name | 项目名称 | VARCHAR(100) | 是 | 否 | 否 | - | 项目名称，如 '奇门遁甲问事助手' |
| description | 项目描述 | TEXT | 否 | 否 | 否 | NULL | 项目描述，说明该项目做什么、适用范围等 |
| created_at | 创建时间 | TIMESTAMPTZ | 是 | 否 | 否 | NOW() | 创建时间 |
| updated_at | 更新时间 | TIMESTAMPTZ | 是 | 否 | 否 | NOW() | 更新时间 |

## 已生成的文件

1. **前台页面**：`app/admin/context/projects/page.tsx`
   - 使用 Ant Design 组件
   - 支持分页（10、100、全部）
   - 支持增删改查操作
   - 项目代码字段在编辑时禁用（不允许修改）
   - 项目代码格式验证（只能包含小写字母、数字和下划线）
   - 时间字段格式化显示

2. **后台 API**：`app/api/admin/context/projects/route.ts`
   - GET：查询项目列表（支持分页，按创建时间降序排序）
   - POST：新增项目（验证必填字段、项目代码唯一性、格式验证）
   - PUT：更新项目（支持部分字段更新，项目代码不允许修改）
   - DELETE：删除项目（检查外键约束）

## 业务规则

1. **项目代码（code）**：
   - 必须唯一
   - 只能包含小写字母、数字和下划线（`/^[a-z0-9_]+$/`）
   - 最大长度：50个字符
   - **不允许修改**：创建后不允许修改项目代码

2. **项目名称（name）**：
   - 必填字段
   - 最大长度：100个字符

3. **项目描述（description）**：
   - 可选字段
   - 最大长度：1000个字符

4. **主键类型**：
   - 使用 UUID 类型，方便分布式唯一标识
   - 自动生成（`gen_random_uuid()`）

5. **时间戳**：
   - `created_at`：创建时间，自动设置
   - `updated_at`：更新时间，在更新记录时自动更新为当前时间

6. **外键约束**：
   - 该项目可能被其他表引用（如 `prompt_templates` 表）
   - 删除项目时，如果被其他数据引用，会触发外键约束错误

## 特殊处理

1. **UUID 主键**：使用 UUID 类型而不是自增整数，适合分布式系统
2. **项目代码不可修改**：编辑时项目代码字段为禁用状态，后台也做保护
3. **项目代码格式验证**：前端和后台都进行格式验证，确保只包含小写字母、数字和下划线
4. **唯一性验证**：创建和更新时都检查项目代码的唯一性
5. **时间格式化**：创建时间和更新时间显示为 `YYYY-MM-DD HH:mm:ss` 格式

## 扩展功能建议

1. **项目统计**：统计每个项目下的提示词模板数量、版本数量等
2. **项目权限**：支持项目级别的权限管理
3. **项目配置**：支持项目级别的配置管理
4. **项目导入导出**：支持项目的导入导出功能
5. **项目关联分析**：分析项目之间的关联关系
6. **项目使用情况**：统计项目的使用频率、调用次数等

## 执行规则

当需要修改或扩展功能时，可以在此文件中添加新的规则说明，然后执行相应的操作。

