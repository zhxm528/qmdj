# 判旺衰与身态（强/弱/偏强/偏弱，谨慎判从）→ 输出：结论 + 证据条目
写一套**可程序化**的“判旺衰与身态”方法：先算一个**结论**，再附上可追溯的**证据条目**（每条都有来源与正/负贡献）。



## 1) 判旺衰的总思路：把“扶身”与“耗身/克身”量化

对日主（日干）只做一件事：统计它的力量来源与去向。

### 扶身（+）

1. **得令**：日主五行在月令季节的状态（旺相休囚死）
2. **得地（通根）**：地支藏干里有日主同类（根），尤其月支/日支
3. **得助（比劫）**：天干/藏干有同五行来帮身
4. **得生（印）**：天干/藏干有生我者（印星）来生身

### 耗身/克身（-）

5. **被克（官杀）**：克我者强则我弱
6. **泄（食伤）**：我生者多则泄身
7. **耗（财）**：我克者多则耗身（尤其身弱忌财多）

> 你要的“证据条目”，本质就是把这 7 类因素逐条列出来。



## 2) 一个够用的“打分框架”（不等于真理，但很稳、很好解释）

你可以用“净分 S”来分强弱。权重可以按你产品需求再调。

### 2.1 得令（季节基调）→ `season_score`

先用你上一步的旺相休囚死表，取“日主五行”的状态：

* 旺 +3
* 相 +2
* 休 +1
* 囚 -1
* 死 -2
  （辰戌丑未过渡月：土额外 +1，或把土相关项乘 1.2）

### 2.2 通根（得地）→ `root_score`

看四支藏干中是否出现日主同五行（甲日主看甲/乙都算木根）：

* 本气根 +2
* 中气根 +1
* 余气根 +0.5
  位置加权（很关键）：
* 月支根 ×1.5
* 日支根 ×1.2
* 时支根 ×1.0
* 年支根 ×0.8

### 2.3 得助/得生（天干与透出）→ `support_score`

按“出现一次算一次”，再按位置加权：

* 比劫（同我）每个 +1.5
* 印（生我）每个 +1.5
* 月干 ×1.3，时干 ×1.1，年干 ×1.0（可自行设）

### 2.4 克泄耗（官杀/食伤/财）→ `drain_score`

* 官杀（克我）每个 -2.0（通常比财食伤更致命）
* 食伤（我生）每个 -1.2
* 财（我克）每个 -1.0
  同样可位置加权（月干/月支相关项权重大）。

### 2.5 合冲刑害对“根与力”的修正 → `damage_adjust`

只做最常用的几条就能显著提升准确率：

* **根所在支被冲**：该根贡献 ×0.6（或直接扣 0.5~1 分）
* **日主被干合且“合去”**（你采用此派规则时）：日主力 -0.5~-1
* **成局把气势带走**（三合/三会明显）：把相关五行阵营的项 ×1.2（这属于高级项，可后加）

最终：

> **S = season_score + root_score + support_score + drain_score + damage_adjust**



## 3) 输出“身态结论”的划分规则（建议默认）

按 S 的区间给“身态”：

* **身强**：S ≥ +4
* **偏强**：+2 ≤ S ≤ +3.5
* **平衡**：-1.5 ≤ S ≤ +1.5
* **偏弱**：-3.5 ≤ S ≤ -2
* **身弱**：S ≤ -4

> 这套阈值不神秘：核心是让“证据条目”能自洽，而不是追求某派绝对标准。



## 4) “从格”判定（必须加硬条件，默认不从）

从强/从弱是最容易误判的，所以用**硬门槛 + 否决项**。

### 4.1 从弱（弃命从势）的必要条件（建议）

同时满足：

* **日主无根或根极弱**：root_score < 1（且月支/日支无本气根）
* **扶身极少**：support_score < 2（印比少且不在关键位）
* **克泄耗成势且“同党多”**：drain侧（官杀/财/食伤）明显多、且得令/成局
* **否决项**：只要出现“强印强比来救”或“关键根不受伤”，直接否决从弱

结论输出要写成：

* `从弱（候选/成立/否决）` + “否决原因/成立证据”

### 4.2 从强同理

* 得令 + 强根 + 印比成势
* 官杀财食伤难以制衡
* 关键否决项：官杀得令且有力克身、或有明显泄耗把身带走



## 5) 你要的输出格式：结论 + 证据条目（推荐 JSON）

```json
{
  "day_master_strength": {
    "status": "偏弱",
    "score": -2.6,
    "from_candidate": {
      "type": "从弱",
      "state": "否决",
      "reason": "月支有本气根且有透印救身"
    }
  },
  "evidence": [
    {
      "category": "得令",
      "source": "月令",
      "detail": "日主为木，月令在秋季金旺，木为死/囚",
      "impact": -2.0
    },
    {
      "category": "得地(通根)",
      "source": "日支",
      "detail": "日支藏乙木（中气根），日支加权后贡献 +1.2",
      "impact": 1.2
    },
    {
      "category": "得生(印)",
      "source": "月干",
      "detail": "月干出现生我之印，且在月干位置加权",
      "impact": 2.0
    },
    {
      "category": "被克(官杀)",
      "source": "年干",
      "detail": "年干为克我之金，官杀透出",
      "impact": -2.0
    },
    {
      "category": "合冲修正",
      "source": "地支冲",
      "detail": "根所在支被冲，根贡献下调 40%",
      "impact": -0.8
    }
  ]
}
```



## 6) 最重要的“自检”（避免强弱结论自相矛盾）

输出时顺带做 3 条校验：

1. 你说身弱，但 evidence 里印比 + 根很强 → 结论要回退或标“分歧”
2. 你说从弱，但 evidence 里有强根/强印救应 → 必须否决从弱
3. 你说身强，但官杀得令且克身很狠 → 要么降级为“偏强/平衡”，要么解释“有制化”

## 核心功能
- 前端页面：`/app/bazi/page.tsx`
- 步骤4程序：`/app/api/bazi/step4.ts`
- 数据库：`/md/database/2_qimen_pan.sql`
- 配置文件： `/lib/config.ts`
- 重写后台程序，按上面规则生成代码判旺衰与身态（强/弱/偏强/偏弱，谨慎判从）→ 输出：结论 + 证据条目。
