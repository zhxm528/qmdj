# 获得"得地（根气）"的计算结果
- 得地（根气）的数据库文件 `/md/database/21_rootqi.sql`
- `/app/api/bazi/rootqi/route.ts` 获得得地（根气）计算的基础数据
- 日志打印得地（根气）结果
- 得地（根气）结果保存到数据库



## 数据库结构

### 1. 明细表：`bazi_root_qi_detail_tbl`
每条记录表示"某目标天干"在"某柱地支"的藏干中找到根，并记录主/中/余气与评分证据。

### 2. 汇总表：`bazi_root_qi_summary_tbl`
按目标天干汇总根气总分和强弱分级。

### 3. 分级阈值表：`bazi_root_qi_level_threshold_dict`
将 `total_root_score` 映射到 `root_level` 的阈值配置表。

**默认阈值（DEFAULT规则集）**：
- `NONE`：`[0.0000, 0.2500)` - 无根或几乎无根
- `WEAK`：`[0.2500, 1.0000)` - 弱根：有根但力度不足
- `MEDIUM`：`[1.0000, 2.0000)` - 中根：根气可用
- `STRONG`：`[2.0000, 9999.0000)` - 强根：根气充足


## 计算逻辑

### 输入信息：
- 从数据库 `/md/database/11_bazi.sql` 的 `bazi_pillar_tbl` 表中获取四柱盘面。
- 从数据库 `/md/database/12_cangganbiao.sql` 的 `bazi_branch_hidden_stem_dict` 表中获取地支藏干字典。
- 从数据库 `/md/database/13_yinyangwuxing.sql` 的 `dict_heavenly_stem` 表中获取天干五行/阴阳字典
- 从数据库 `/md/database/20_deling.sql` 的 `bazi_deling_result_tbl` 表中获取得令结果
- 从数据库 `/md/database/14_ganhe.sql` 的 `bazi_relation_entry` 表中获取冲合刑害破字典

### 通用计算逻辑（可落库）
#### Step 1：找“根”（有无）

对每个 目标天干 S（如日主、月干、年干、时干）：

遍历四个地支（年支/月支/日支/时支）

查询该地支的藏干列表

如果藏干里出现：

同一“天干”（最硬的根，例如 甲见亥藏甲）

或者（更常用）同五行的藏干（同气根，例如 甲见寅藏甲、卯主气乙也算木根）
则记为：is_root = true，并记录来自哪个支、对应藏干是主/中/余气。

实务里通常按“同五行”算通根；若要更严格，可同时输出“同干根/同气根”两套字段。

#### Step 2：给“根气强弱”打分（建议可配置）

根气强弱通常由三类乘起来：

藏干层级权重（主/中/余）

主气：1.0

中气：0.6

余气：0.3
（示例，可配）

支位权重（年/月/日/时）

月支：1.0

日支：0.8

时支：0.6

年支：0.4
（示例，可配）

得令修正（季节对该五行的旺相休囚）

旺：1.2

相：1.0

休：0.7

囚：0.5

死：0.3
（示例，可配）

最终：
root_score = hidden_rank_w * pillar_pos_w * season_element_w
再把同一目标天干在四支的 root_score 加总：
total_root_score，并可映射成“无根/弱根/有根/强根”。

#### Step 3：输出证据（非常建议）

每条根记录带上：

来自哪个支（年/月/日/时）

地支藏干命中的是哪个干、主/中/余气

当月令季节下该五行状态（旺相休囚死）

参与的权重和最终分数
这样后面你做“旺衰、用神、合化成败”才能解释得清楚、也便于调参。

### 落库设计：把“根气计算结果”存入 

