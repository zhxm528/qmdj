# 日期选择器使用说明

## 功能特性

日期选择器组件 (`DateSelector`) 支持以下功能：

### 1. 年份选择 - 显示干支年

- **阳历年**：显示公历年份（如 2024）
- **干支年**：自动计算并显示对应的干支年（如 甲辰）
- 格式：`2024年 (甲辰)`

### 2. 月份选择 - 显示干支月

- **阳历月**：显示公历月份（如 2月）
- **干支月**：自动计算并显示对应的干支月（如 乙卯）
- 格式：`2月 (乙卯)`
- 根据选定年份自动计算干支月（五虎遁月法）

### 3. 智能联动

- 选择年份后才能选择月份
- 选择年份和月份后才能选择日期
- 自动调整日期上限（如 2 月只有 28/29 天）
- 年份变化时，月份的干支月自动更新

## 算法说明

### 4. 干支年算法

根据 `yearto.md` 规则实现：

- **基准年**：公元 4 年为甲子年
- **算法**：
  - 天干序号：`(year - 4) mod 10`
  - 地支序号：`(year - 4) mod 12`
  - 干支名 = 天干表[干序] + 地支表[支序]
- **天干表**：甲、乙、丙、丁、戊、己、庚、辛、壬、癸
- **地支表**：子、丑、寅、卯、辰、巳、午、未、申、酉、戌、亥

### 5. 干支月算法

根据 `monthto.md` 规则实现（五虎遁月法）：

- **建寅起月**：阳历 2 月对应寅月（第 1 月）
- **月支映射**：
  - 阳历 1 月 → 丑月
  - 阳历 2-12 月 → 寅至子月
- **五虎遁月法**（根据年干确定寅月起干）：
  - 甲、己年 → 寅月天干 = 甲
  - 乙、庚年 → 寅月天干 = 丙
  - 丙、辛年 → 寅月天干 = 戊
  - 丁、壬年 → 寅月天干 = 庚
  - 戊、癸年 → 寅月天干 = 壬
- 其余月份：月干 = 寅月起干 + (月序-1)

### 6. 立春界线处理

奇门遁甲使用术数口径，以立春为干支年切换点：

- 立春（约 2 月 4 日）之后：使用当前年的干支
- 立春之前：使用上一年的干支
- 例如：2024-02-01 仍属癸卯年，立春后进入甲辰年

## 使用示例

```tsx
import DateSelector from "@/components/DateSelector";

function MyComponent() {
  const [date, setDate] = useState("");

  return (
    <DateSelector 
      value={date} 
      onChange={setDate} 
      required 
    />
  );
}
```

## API

### Props

| 属性 | 类型 | 必填 | 说明 |
|------|------|------|------|
| value | string | 是 | 日期值（YYYY-MM-DD 格式） |
| onChange | (date: string) => void | 是 | 日期变化回调 |
| required | boolean | 否 | 是否必填 |

### 干支工具函数

```typescript
import { 
  yearToGanzhi, 
  getGanzhiYear, 
  getYearOptions,
  monthToGanzhi,
  getMonthOptions
} from "@/lib/ganzhi";

// 将年份转换为干支年
yearToGanzhi(2024); // "甲辰"

// 获取指定日期对应的干支年（考虑立春）
getGanzhiYear(2024, 2, 3);  // "癸卯"（立春前）
getGanzhiYear(2024, 2, 5);  // "甲辰"（立春后）

// 将月份转换为干支月
monthToGanzhi(2024, 2); // "乙卯"
monthToGanzhi(2024, 3); // "丙辰"

// 获取年份选项列表
getYearOptions(1950, 2050); 
// [{ value: 1950, label: "1950年 (庚寅)", ganzhi: "庚寅" }, ...]

// 获取月份选项列表（需要年份）
getMonthOptions(2024); 
// [{ value: 1, label: "1月 (乙丑)", ganzhi: "乙丑" }, ...]
```

## 响应式设计

- **桌面端**：三个下拉框并排显示
- **移动端**：自动适配，保持良好的触控体验
- **iOS Safari**：兼容原生下拉样式

## 注意事项

1. **年份范围**：默认 1950-2050，可在 `getYearOptions()` 中调整
2. **日期自动纠错**：切换到小月时，自动调整日期
3. **禁用状态**：未选年份时，月份和日期选择器自动禁用
4. **干支月计算**：
   - 简化版本：按整月分配，未考虑具体节气时刻
   - 如需精确节气计算，需要集成节气库（如 solar-terms）
   - 当前实现：阳历 2 月对应寅月，1 月对应丑月

